<launch>
  <!-- Start kinect driver -->
  <include file="$(find freenect_launch)/launch/freenect.launch"></include>

  <!-- Start kinect depth frame converter to convert depth image from int millimetres to double metres
       (this is required for fovis) -->
  <node pkg="nodelet" type="nodelet" args="manager" name="nodelet_manager" />
  <node pkg="nodelet" type="nodelet" name="convert_freenect_fovis" 
        args="load depth_image_proc/convert_metric nodelet_manager">
    <remap from="image_raw" to="/camera/depth/image_rect_raw"/>
    <remap from="image" to="/camera/depth_registered/image_rect"/>
  </node>

  <!-- Start fovis itself -->
  <node pkg="fovis_ros" type="fovis_mono_depth_odometer" name="kinect_odometer" >
    <remap from="/camera/rgb/image_rect" to="/camera/rgb/image_rect_mono" />
    <remap from="/camera/rgb/camera_info" to="/camera/rgb/camera_info" />
    <remap from="/camera/depth_registered/camera_info" to="/camera/depth/camera_info" />
    <remap from="/camera/depth_registered/image_rect" to="/camera/depth_registered/image_rect" />
    <param name="odom_frame_id" type="string" value="/world" />
    <param name="base_link_frame_id" type="string" value="/camera_link" />
    <param name="approximate_sync" type="bool" value="True" />
    <param name="publish_tf" type="bool" value="True" />
  </node>

  <!-- Start rviz visualization with preset config -->
  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find fovis_ros)/launch/fovis-demo.rviz"/>

</launch>
